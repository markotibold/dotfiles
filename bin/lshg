#!/bin/bash
source ~/.dotfiles/colors.sh
for dir in ./*/
do
    cd ${dir%*/}
    curr_dir=${dir:2}
    if ! hg_status="$(hg status 2> /dev/null)"; then
        echo 'Not a hg repo' ${curr_dir}
    else
        if [[ "${hg_status}" == "" ]]; then
            state="${GREEN}"
        # Modified, Added or Removed
        elif [[ "${hg_status}" =~ ^[M|A|R] ]]; then
            state="${YELLOW}"
        else
            state="${RED}"
        fi
        echo ${state}${curr_dir}${COLOR_NONE}
    fi
    cd ..
done
